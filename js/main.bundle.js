!function(){"use strict";var t,e={941:function(){},178:function(t,e,n){const i=n(212),s=n(526),o=n(275);document.getElementById("files").addEventListener("change",s.handleFiles_pointCloud,!1),document.getElementById("mosa").addEventListener("click",s.startAlg_pointCloud_new,!1);class a{constructor(){this.camera=new i.OrthographicCamera(-640,640,320,-320,-1e4,1e4),this.camera.position.set(0,0,1e4),this.camera.zoom=1,this.camera.up.set(0,0,1),this.camera.lookAt(new i.Vector3(0,0,0)),this.scene=new i.Scene,n.g.scene=this.scene,this.renderer=new i.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),window.addEventListener("resize",this.onWindowResize.bind(this),!1),this.controls=new o.OrbitControls(this.camera,this.renderer.domElement),this.initControl(),this.animate()}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}animate(){requestAnimationFrame(this.animate.bind(this)),this.renderer.render(this.scene,this.camera)}initControl(){this.controls.enableDamping=!0,this.controls.enableZoom=!0,this.controls.zoomSpeed=3,this.controls.autoRotate=!1,this.controls.enableRotate=!0,this.controls.minDistance=1,this.controls.maxDistance=1e3,this.controls.rotateSpeed=.4,this.controls.enableKeys=!1,this.controls.addEventListener("change",(()=>{this.renderer.render(this.scene,this.camera)})),this.controls.reset()}}new a},388:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.HoughAnalyser=e.HoughAnalyserType=void 0;const i=n(882);var s;!function(t){t[t.line=0]="line",t[t.circle=1]="circle"}(s=e.HoughAnalyserType||(e.HoughAnalyserType={}));class o{constructor(t,e,n,i){this._pts=t,this._disStep=e,this._angleStep=n,this._threshold=i}start(){const t={min:[Number.MAX_VALUE,Number.MAX_VALUE],max:[-Number.MAX_VALUE,-Number.MAX_VALUE]};this._pts.forEach((e=>{i.addPtToBox(t,[e.x,e.y])}));const e=4*this._disStep;t.min=[t.min[0]-e,t.min[1]-e],t.max=[t.max[0]+e,t.max[1]+e];const n=t.max[0]-t.min[0],s=t.max[1]-t.min[1],o=t.min[0]+.5*n,a=t.min[1]+.5*s,r=Math.sqrt(n*n+s*s),h=.5*r,l=Math.floor(r/this._disStep),c=[],u=[],d=[];for(let t=0,e=0;t<Math.PI;t+=this._angleStep,e++)c[e]=t,u[e]=Math.sin(t),d[e]=Math.cos(t);const p=[];for(var f=0;f<c.length;f++){p[f]=[];for(var m=0;m<l;m++)p[f][m]={value:0,indices:[]}}for(let t=0;t<this._pts.length;t++){const e=this._pts[t],n=e.x-o,i=e.y-a;for(var g=0;g<c.length;g++){var b=n*d[g]+i*u[g]+h;const t=Math.floor(b/this._disStep);p[g][t].value+=1,p[g][t].indices.push(e.index)}}let y=-1;for(f=0;f<p.length;f++)for(m=0;m<p[0].length;m++)p[f][m].value>y&&(y=p[f][m].value);y=.8*y>this._threshold?.8*y:this._threshold;for(f=0;f<p.length;f++)for(m=0;m<p[0].length;m++)p[f][m].value<y&&(p[f][m].value=0);var M=new Array;for(f=0;f<p.length;f++){M[f]=[];for(m=0;m<p[0].length;m++)M[f][m]={value:p[f][m].value,indices:p[f][m].indices}}for(f=0;f<p.length;f++)for(m=0;m<p[0].length;m++){let t=!1;for(var w=f-2;w<f+3;w++)if(!(w<0||w>p.length-1)){for(var P=m-2;P<m+3;P++)if(!(P<0||P>p[0].length-1)&&p[w][P].value>p[f][m].value){M[f][m].value=0,t=!0;break}if(t)break}}for(f=0;f<p.length;f++)for(m=0;m<p[0].length;m++)p[f][m]=M[f][m];const v=[],x=.5*n,E=.5*s,L=[],V=Math.cos(4*this._angleStep),D=(t,e,n)=>{for(const i of L){const s=i[0]*t+e*i[1];if(Math.abs(s)>V){const t=(s>0?i[2]:-i[2])-n;if(Math.abs(t)<4*this._disStep)return!1}}return L.push([t,e,n]),!0};for(f=0;f<p.length;f++)for(m=0;m<l;m++)if(p[f][m].value>0){var S=c[f],j=m*this._disStep-h;if(!D(d[f],u[f],j))continue;const t=new Set(p[f][m].indices);for(w=f-2;w<f+3;w++)if(!(w<0||w>p.length-1))for(P=m-2;P<m+3;P++)P<0||P>p[0].length-1||p[w][P].indices.forEach((e=>t.add(e)));var O,_,z,A;S>Math.PI/4&&S<2*Math.PI/3?(O=(j-(z=-x)*d[f])/u[f],_=(j-(A=x)*d[f])/u[f]):(z=(j-(O=-E)*u[f])/d[f],A=(j-(_=E)*u[f])/d[f]);const e={st:{x:z+o,y:O+a},et:{x:A+o,y:_+a},indices:Array.from(t)};v.push(e)}return v}}e.HoughAnalyser=class{static run(t,e,n,i,a){switch(e){case s.line:return new o(t,n,i,a).start();case s.circle:}return[]}}},275:function(t,e,n){var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.OrbitControls=void 0;const a=o(n(212)),r=-1,h=0,l=1,c=2,u=3,d=4,p=5,f={type:"change"},m={type:"start"},g={type:"end"},b=1e-6;class y extends a.EventDispatcher{constructor(t,e,n){super(),this.mouse3D=new a.Vector3,this.zoomFactor=1,this.object=t,this.domElement=void 0!==e?e:document,this.window=void 0!==n?n:window,this.enabled=!0,this.target=new a.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:a.MOUSE.LEFT,ZOOM:a.MOUSE.MIDDLE,PAN:a.MOUSE.MIDDLE},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.updateOffset=new a.Vector3,this.updateQuat=(new a.Quaternion).setFromUnitVectors(t.up,new a.Vector3(0,1,0)),this.updateQuatInverse=this.updateQuat.clone().inverse(),this.updateLastPosition=new a.Vector3,this.updateLastQuaternion=new a.Quaternion,this.state=r,this.scale=1,this.spherical=new a.Spherical,this.sphericalDelta=new a.Spherical,this.panOffset=new a.Vector3,this.zoomChanged=!1,this.rotateStart=new a.Vector2,this.rotateEnd=new a.Vector2,this.rotateDelta=new a.Vector2,this.panStart=new a.Vector2,this.panEnd=new a.Vector2,this.panDelta=new a.Vector2,this.dollyStart=new a.Vector2,this.dollyEnd=new a.Vector2,this.dollyDelta=new a.Vector2,this.panLeftV=new a.Vector3,this.panUpV=new a.Vector3,this.panInternalOffset=new a.Vector3,this.onMouseDown=t=>{const e=t;if(!1!==this.enabled){if(e.preventDefault(),e.button===this.mouseButtons.ORBIT){if(!1===this.enableRotate)return;this.rotateStart.set(e.clientX,e.clientY),this.state=h}else if(e.button===this.mouseButtons.ZOOM){if(!1===this.enableZoom)return;this.panStart.set(e.clientX,e.clientY),this.state=c}else if(e.button===this.mouseButtons.PAN){if(!1===this.enablePan)return;this.panStart.set(e.clientX,e.clientY),this.state=c}this.state!==r&&(document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(m))}},this.onMouseMove=t=>{const e=t;if(!1!==this.enabled)if(e.preventDefault(),this.state===h){if(!1===this.enableRotate)return;this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);const t=this.domElement===document?this.domElement.body:this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd),this.update()}else if(this.state===l){if(!1===this.enableZoom)return;this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyOut(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}else if(this.state===c){if(!1===this.enablePan)return;this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update()}},this.onMouseUp=t=>{!1!==this.enabled&&(document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(g),this.state=r)};const i=t=>{const e=new a.Vector3,n=new a.Vector3,i=this,s=i.domElement===document?i.domElement.body:i.domElement;if(i.object.isPerspectiveCamera){e.set(t.offsetX/s.clientWidth*2-1,-t.offsetY/s.clientHeight*2+1,.5),e.unproject(i.object),e.sub(i.object.position).normalize();var o=n.copy(i.target).sub(i.object.position).dot(i.object.up)/e.dot(i.object.up);return(new a.Vector3).copy(i.object.position).add(e.multiplyScalar(o))}if(i.object.isOrthographicCamera){e.set(t.offsetX/s.clientWidth*2-1,-t.offsetY/s.clientHeight*2+1,(i.object.near+i.object.far)/(i.object.near-i.object.far)),e.unproject(i.object),n.set(0,0,-1).applyQuaternion(i.object.quaternion);o=-e.dot(i.object.up)/n.dot(i.object.up);return(new a.Vector3).copy(e).add(n.multiplyScalar(o))}};this.onMouseWheel=t=>{const e=t;!1===this.enabled||!1===this.enableZoom||this.state!==r&&this.state!==h||(e.preventDefault(),e.stopPropagation(),this.mouse3D=i(t),e.deltaY<0?this.dollyOut(this.getZoomScale()):e.deltaY>0&&this.dollyIn(this.getZoomScale()),this.update(),delete this.mouse3D,this.dispatchEvent(m),this.dispatchEvent(g))},this.onKeyDown=t=>{const e=t;if(!1!==this.enabled&&!1!==this.enableKeys&&!1!==this.enablePan)switch(e.keyCode){case this.keys.UP:this.pan(0,this.keyPanSpeed),this.update();break;case this.keys.BOTTOM:this.pan(0,-this.keyPanSpeed),this.update();break;case this.keys.LEFT:this.pan(this.keyPanSpeed,0),this.update();break;case this.keys.RIGHT:this.pan(-this.keyPanSpeed,0),this.update()}},this.onTouchStart=t=>{const e=t;if(!1!==this.enabled){switch(e.touches.length){case 1:if(!1===this.enableRotate)return;this.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),this.state=u;break;case 2:{if(!1===this.enableZoom)return;const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);this.dollyStart.set(0,i),this.state=d}break;case 3:if(!1===this.enablePan)return;this.panStart.set(e.touches[0].pageX,e.touches[0].pageY),this.state=p;break;default:this.state=r}this.state!==r&&this.dispatchEvent(m)}},this.onTouchMove=t=>{const e=t;if(!1!==this.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:{if(!1===this.enableRotate)return;if(this.state!==u)return;this.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);const t=this.domElement===document?this.domElement.body:this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd),this.update()}break;case 2:{if(!1===this.enableZoom)return;if(this.state!==d)return;const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);this.dollyEnd.set(0,i),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}break;case 3:if(!1===this.enablePan)return;if(this.state!==p)return;this.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update();break;default:this.state=r}},this.onTouchEnd=t=>{!1!==this.enabled&&(this.dispatchEvent(g),this.state=r)},this.onContextMenu=t=>{t.preventDefault()},this.domElement.addEventListener("contextmenu",this.onContextMenu,!1),this.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.domElement.addEventListener("wheel",this.onMouseWheel,!1),this.domElement.addEventListener("touchstart",this.onTouchStart,!1),this.domElement.addEventListener("touchend",this.onTouchEnd,!1),this.domElement.addEventListener("touchmove",this.onTouchMove,!1),this.window.addEventListener("keydown",this.onKeyDown,!1),this.update()}update(){const{position:t}=this.object;return this.updateOffset.copy(t).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===r&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.mouse3D&&this.target.lerp(this.mouse3D,1-this.zoomFactor),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),t.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),!0===this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>b||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>b)&&(this.dispatchEvent(f),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}panLeft(t,e){this.panLeftV.setFromMatrixColumn(e,0),this.panLeftV.multiplyScalar(-t),this.panOffset.add(this.panLeftV)}panUp(t,e){this.panUpV.setFromMatrixColumn(e,1),this.panUpV.multiplyScalar(t),this.panOffset.add(this.panUpV)}pan(t,e){const n=this.domElement===document?this.domElement.body:this.domElement;if(this.object instanceof a.PerspectiveCamera){const{position:i}=this.object;this.panInternalOffset.copy(i).sub(this.target);let s=this.panInternalOffset.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*t*s/n.clientHeight,this.object.matrix),this.panUp(2*e*s/n.clientHeight,this.object.matrix)}else this.object instanceof a.OrthographicCamera?(this.panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this.panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):this.enablePan=!1}dollyIn(t){this.object instanceof a.PerspectiveCamera?this.scale/=t:this.object instanceof a.OrthographicCamera?(this.zoomFactor=this.object.zoom,this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*t)),this.zoomFactor/=this.object.zoom,this.object.updateProjectionMatrix(),this.zoomChanged=!0):this.enableZoom=!1}dollyOut(t){this.object instanceof a.PerspectiveCamera?this.scale*=t:this.object instanceof a.OrthographicCamera?(this.zoomFactor=this.object.zoom,this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/t)),this.zoomFactor/=this.object.zoom,this.object.updateProjectionMatrix(),this.zoomChanged=!0):this.enableZoom=!1}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("wheel",this.onMouseWheel,!1),this.domElement.removeEventListener("touchstart",this.onTouchStart,!1),this.domElement.removeEventListener("touchend",this.onTouchEnd,!1),this.domElement.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.window.removeEventListener("keydown",this.onKeyDown,!1)}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(f),this.update(),this.state=r}get center(){return this.target}get noZoom(){return!this.enableZoom}set noZoom(t){this.enableZoom=!t}}e.OrbitControls=y},526:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.startAlg_pointCloud_new=e.startAlg_pointCloud=e.showPts=e.handleFiles_pointCloud=void 0;const i=n(212),s=n(388),o=n(882),a=n(425);function r(t,e,n=16711680,s=1){const o=t.map((t=>new i.Vector2(t.x,t.y)));var a=(new i.BufferGeometry).setFromPoints(o),r=new i.LineBasicMaterial({color:n,linewidth:s}),h=new i.Line(a,r);e.add(h)}function h(t,e,n=2201331,s=1){const o=(new i.BufferGeometry).setFromPoints(t),a=new i.PointsMaterial({color:n,size:s}),r=new i.Points(o,a);e.add(r)}e.handleFiles_pointCloud=function(){const t=document.getElementById("files").files;var e=0,i=new FileReader;i.readAsText(t[e]),i.onload=function(){let s=JSON.parse(this.result);if(s.pointcloud)n.g.pointcloudData=s;else if(Array.isArray(s)){const t=[];n.g.pointcloudData={pointcloud:t};for(let e=0;e<s.length;e+=2)t.push({x:.05*s[e],y:.05*s[e+1]})}++e<t.length&&i.readAsText(t[e])}},e.showPts=function(){const t=n.g.pointcloudData,e=[];for(let n=0;n<t.length;n+=2){const i=t[n]*Math.PI/180,s=t[n+1]*Math.cos(i),o=t[n+1]*Math.sin(i);e.push({x:s,y:o,z:0})}h(e,n.g.scene)},e.startAlg_pointCloud=function(){const t=n.g.pointcloudData.pointcloud;for(let e=0;e<t.length;e++)t[e].index=e;let e=[],a=0,l=!1,c=t.slice();const u=.05,d=2*Math.PI/180;h(c,n.g.scene);do{const n=s.HoughAnalyser.run(c,s.HoughAnalyserType.line,u,d,40),r=new Set;l=!1;for(let s=0;s<n.length;s++){const a=n[s].indices.map((e=>t[e])),h=(new i.Vector2).subVectors(n[s].et,n[s].st).normalize(),c=a.slice(0,a.length);c.sort(((t,e)=>o.getLineParam(n[s].st,h,t)-o.getLineParam(n[s].st,h,e)));Math.abs(o.getLineParam(n[s].st,h,c[0])-o.getLineParam(n[s].st,h,c[c.length-1]));let u=[],d=-1;for(let t=0;t<c.length;t++)d<0?d=t:Math.abs(o.pointDistance(c[t],c[t-1]))>1.5&&(u.push(c.slice(d,t)),d=-1);d>=0&&u.push(c.slice(d,c.length)),u=u.filter((t=>t.length>=5)),u.forEach((t=>{const a=o.getLineParam(n[s].st,h,t[0]),c=o.getLineParam(n[s].st,h,t[t.length-1]);if(Math.abs(a-c)<1)return;const u=o.ransac(t,.1);if(u){e.push(u.line),l=!0;const n=(new i.Vector2).subVectors(u.line.et,u.line.st).normalize();t.forEach((t=>{o.getLineDistance(u.line.st,n,t)<.1&&r.add(t)}))}}))}c=c.filter((t=>!r.has(t))),a++}while(l&&a<10);e.forEach((t=>r([t.st,t.et],n.g.scene)))},e.startAlg_pointCloud_new=function(){const t=n.g.pointcloudData.pointcloud;h(t,n.g.scene,2201331,3);const{resultLines:e,leftPoints:i}=a.roomBuild2d(t);e.forEach((t=>r([t.st,t.et],n.g.scene,16711680,2)))}},425:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.roomBuild2d=void 0;const i=n(388),s=n(212),o=n(882),a=.05;function r(t,e,n,i=!1){t.sort(((t,n)=>o.getLineParam(new s.Vector2,e,t)-o.getLineParam(new s.Vector2,e,n)));let a=[],r=-1;for(let e=0;e<t.length;e++)r<0?r=e:o.pointDistance(t[e],t[e-1])>1&&(a.push(t.slice(r,e)),r=-1);r>=0&&a.push(t.slice(r,t.length)),a=a.filter((t=>t.length>=4));const h=[];for(const t of a){const n=[];for(let e=0;e<t.length-1;e++){const i=(new s.Vector2).subVectors(t[e],t[e+1]).normalize();let o=!1;for(let t=0;t<n.length;t++)if(n[t][0].dot(i)>Math.cos(Math.PI/36)){n[t].push(i),o=!0;break}o||n.push([i])}if(n.sort(((t,e)=>e.length-t.length)),n[0].length/(t.length-1)>.5||i){let a=new s.Vector2;i?a=e:(n[0].forEach((t=>a.add(t))),a.divideScalar(n[0].length));const r=new s.Vector2;t.forEach((t=>r.add(t))),r.divideScalar(t.length);const l=o.getLinePt(r,a,o.getLineParam(r,a,t[0])),c=o.getLinePt(r,a,o.getLineParam(r,a,t[t.length-1]));h.push({line:{st:l,et:c},dir:(new s.Vector2).subVectors(c,l).normalize(),pts:t});continue}const a=o.ransac(t,.1);a&&o.pointDistance(a.line.st,a.line.et)>.2&&h.push({line:a.line,dir:(new s.Vector2).subVectors(a.line.et,a.line.st).normalize(),pts:t})}return h.filter((t=>{const n=(new s.Vector2).subVectors(t.line.et,t.line.st).normalize();return Math.abs(n.dot(e))>Math.cos(Math.PI/6)}))}function h(t,e=40){for(let e=0;e<t.length;e++)t[e].index=e;let n=[],h=0,l=!1,c=t.slice();const u=Math.PI/180;do{const d=i.HoughAnalyser.run(c,i.HoughAnalyserType.line,a,u,e);for(let t=d.length-1;t>0;t--){const e=d[t].indices;for(let n=t-1;n>=0;n--){const i=e.filter((t=>d[n].indices.indexOf(t)>-1));if(i.length/e.length>.7||i.length/d[n].indices.length>.7){const i=new Set;e.forEach((t=>i.add(t))),d[n].indices.forEach((t=>i.add(t))),d[n].indices=Array.from(i),d.splice(t,1);break}}}const p=new Set;l=!1;for(let e=0;e<d.length;e++){const i=d[e].indices.map((e=>t[e])),a=(new s.Vector2).subVectors(d[e].et,d[e].st).normalize();r(i.slice(0,i.length),a).forEach((t=>{if(o.pointDistance(t.line.et,t.line.st)<1)return;l=!0;const e=[],i=(new s.Vector2).subVectors(t.line.et,t.line.st).normalize();t.pts.forEach((n=>{o.getLineDistance(t.line.st,i,n)<.2&&(p.add(n),e.push(n))})),n.push({line:t.line,dir:i,pts:e})}))}c=c.filter((t=>!p.has(t))),h++}while(l&&h<5);return{mainLines:n,leftPoints:c}}function l(t,e,n,i){const a=[],h=new Set;function l(t,e){const n=[];return r(t,e,0,!0).forEach((t=>{o.pointDistance(t.line.et,t.line.st)<.2||(n.push(t),t.pts.forEach((t=>h.add(t))))})),n}function c(t,n,r){const h={st:i.getCenter(new s.Vector2),dir:n},c=function(t,e){const n=t.map((t=>{const n=o.getLineParam(e.st,e.dir,t);return Math.round(n/.05)})),i=Math.min(...n),s=Math.max(...n),a=[];for(let t=0;t<s-i+1;t++)a.push([]);for(let e=0;e<n.length;e++)a[n[e]-i].push(t[e]);const r=[];let h=-1;for(let t=0;t<a.length;t++){const e=a[t];if(h<0){if(e.length<=5)continue;if(0===t){h=0;continue}(0===a[t-1].length||e.length/a[t-1].length>2||e.length/a[t-1].length<.3)&&(h=t)}else(e.length<=5||e.length/a[t-1].length<.3)&&(r.push(a.slice(h,t+1).flat()),h=-1)}return h>=0&&r.push(a.slice(h,a.length).flat()),r}(t,h).map((t=>{const e=new s.Vector2;t.forEach((t=>e.add(t))),e.divideScalar(t.length);return{param:o.getLineParam(h.st,h.dir,e),tts:t}})),u=e.filter((t=>{const e=(new s.Vector2).subVectors(t.et,t.st);return Math.abs(e.dot(n))>Math.abs(e.dot(r))}));for(const t of u){const e=o.getLineParam(h.st,h.dir,t.st);if(c.sort(((t,n)=>Math.abs(t.param-e)-Math.abs(n.param-e))),c.length&&Math.abs(c[0].param-e)<.2){const t=l(c[0].tts,r);t.length&&(a.push(...t),c.shift())}const n=o.getLineParam(h.st,h.dir,t.et);if(c.sort(((t,e)=>Math.abs(t.param-n)-Math.abs(e.param-n))),c.length&&Math.abs(c[0].param-n)<.2){const t=l(c[0].tts,r);t.length&&(a.push(...t),c.shift())}}return c}const u=c(t,n.dx,n.dy),d=c(t.filter((t=>!h.has(t))),n.dy,n.dx);return u.forEach((t=>{if(t.tts.length<10)return;const e=l(t.tts,n.dy);e.length&&a.push(...e)})),d.forEach((t=>{if(t.tts.length<10)return;const e=l(t.tts,n.dx);e.length&&a.push(...e)})),{shortLines:a,leftPoints:t.filter((t=>!h.has(t)))}}e.roomBuild2d=function(t){const e=new s.Box2;e.setFromPoints(t);let n=h(t,30);if(n.mainLines.length||(n=h(t,20)),!n.mainLines.length)return;const{dx:i,dy:a}=function(t){const e=t.map((t=>{const e=t.line,n=(new s.Vector2).subVectors(e.et,e.st),i=n.length;return{v:n.normalize(),len:i}})),n=[];for(const t of e){let e=!1;for(const i of n)if(Math.abs(t.v.dot(i[0].v))>Math.cos(Math.PI/12)){i.push(t),e=!0;break}e||n.push([t])}n.sort(((t,e)=>e.length-t.length)),1===n[0].length&&n.sort(((t,e)=>e[0].len-t[0].len));let i=n[0][0].v;for(let t=1;t<n[0].length;t++){const e=n[0][t].v;i.dot(e)<0?i.add(e.negate()):i.add(e)}return i=new s.Vector2(i.x/n[0].length,i.y/n[0].length),{dx:i,dy:new s.Vector2(-i.y,i.x)}}(n.mainLines);n.mainLines=function(t,e,n){return t.forEach((t=>{const i=t.line,a=t.dir;if(Math.abs(a.dot(e))>Math.cos(Math.PI/18)){const n=new s.Vector2;t.pts.forEach((t=>n.add(t))),n.divideScalar(t.pts.length),i.st=o.getLinePt(n,e,o.getLineParam(n,e,i.st)),i.et=o.getLinePt(n,e,o.getLineParam(n,e,i.et)),t.dir=(new s.Vector2).subVectors(i.et,i.st).normalize()}if(Math.abs(a.dot(n))>Math.cos(Math.PI/18)){const e=new s.Vector2;t.pts.forEach((t=>e.add(t))),e.divideScalar(t.pts.length),i.st=o.getLinePt(e,n,o.getLineParam(e,n,i.st)),i.et=o.getLinePt(e,n,o.getLineParam(e,n,i.et)),t.dir=(new s.Vector2).subVectors(i.et,i.st).normalize()}})),t}(n.mainLines,i,a);const{shortLines:r,leftPoints:c}=l(n.leftPoints,n.mainLines.map((t=>t.line)),{dx:i,dy:a},e);let u=n.mainLines;return u=u.concat(r),u=function(t){t.sort(((t,e)=>{const n=o.pointDistance(t.line.st,t.line.et);return o.pointDistance(e.line.st,e.line.et)-n}));const e=[],n=new Set;for(let i=0;i<t.length;i++){const a=t[i];if(n.has(a))continue;const r=(new s.Vector2).subVectors(a.line.et,a.line.st).normalize(),h=o.getLineParam(a.line.st,r,a.line.et),l=[];for(let e=i+1;e<t.length;e++){const i=t[e];if(n.has(i))continue;const c=(new s.Vector2).subVectors(i.line.et,i.line.st).normalize();if(Math.abs(r.dot(c))<Math.cos(Math.PI/18))continue;if(o.getLineDistance(a.line.st,r,i.line.et)>.5)continue;const u=.5*(o.getLineParam(a.line.st,r,i.line.st)+o.getLineParam(a.line.st,r,i.line.et));u<=h&&u>=0&&(l.push(i),n.add(i))}l.length&&(n.add(a),l.unshift(a),e.push(l))}const i=(t,e,n)=>{const i=n.sort(((t,e)=>t[0]-e[0]));let s=t;const o=[],a=t=>{s<t-1e-6&&o.push([s,t])};for(const t of i)a(t[0]),t[1]>s&&(s=t[1]);return a(e),o},a=[];for(const n of e){const e=n[0].line,r=(new s.Vector2).subVectors(e.et,e.st).normalize(),h=o.getLineParam(e.st,r,e.et),l=n.shift(),c=n.map((t=>{let n=o.getLineParam(e.st,r,t.line.st),i=o.getLineParam(e.st,r,t.line.et);if(n>i){const e=n;n=i,i=e;const s=t.line.st;t.line.st=t.line.et,t.line.et=s}return{range:[n,i],line:t}})),u=i(0,h,c.map((t=>t.range))),d=t.indexOf(l);t.splice(d,1);for(const t of u){const i=o.getLinePt(e.st,r,t[0]),s=o.getLinePt(e.st,r,t[1]);a.push({line:{st:i,et:s},pts:n[0].pts})}for(const t of c)t.range[0]>0&&t.range[0]<h&&a.push({line:{st:t.line.line.st,et:o.getLinePt(e.st,r,t.range[0])},pts:[]}),t.range[1]>0&&t.range[1]<h&&a.push({line:{st:t.line.line.et,et:o.getLinePt(e.st,r,t.range[1])},pts:[]})}return t.concat(a)}(u),u=function(t){function e(t,e){const n=o.pointDistance(t.st,e),i=o.pointDistance(t.et,e);return Math.min(n,i)}const n=t;for(const t of n){const i=(new s.Vector2).subVectors(t.line.et,t.line.st).normalize(),a=n.filter((e=>{if(e===t)return!1;const n=(new s.Vector2).subVectors(e.line.et,e.line.st).normalize();return!(Math.abs(i.dot(n))>Math.cos(Math.PI/18))}));if(!a.length)continue;const r=a.slice();r.sort(((n,i)=>e(n.line,t.line.st)-e(i.line,t.line.st)));const h=e(r[0].line,t.line.st),l=a.slice();l.sort(((n,i)=>e(n.line,t.line.et)-e(i.line,t.line.et)));const c=e(l[0].line,t.line.et);if(l[0]!=r[0]){if(h<.2){const e=o.lineIntersect(t.line.st,t.line.et,r[0].line.st,r[0].line.et);e&&o.pointDistance(t.line.st,e)<1.5&&(t.line.st=e,t.done1=!0)}if(c<.2){const e=o.lineIntersect(t.line.st,t.line.et,l[0].line.st,l[0].line.et);e&&o.pointDistance(t.line.et,e)<1.5&&(t.line.et=e,t.done2=!0)}}}const i=n.filter((t=>!(t.done1&&t.done2)));if(i.length<=1)return n;const a=(t,e,i,a,r)=>{let h=o.lineIntersect(t.line.st,t.line.et,i.line.st,i.line.et);const l=1===e?t.line.st:t.line.et,c=1===a?i.line.st:i.line.et;if(h&&o.pointDistance(h,l)<r+.01&&o.pointDistance(h,c)<r+.01){const n=(t,e)=>{const n=.5,i=(new s.Vector2).subVectors(t.line.et,t.line.st).normalize();let a=o.getLineParam(t.line.st,i,t.line.et),r=o.getLineParam(t.line.st,i,h);1===e?r<=n*a&&r>=-.5*a&&(t.line.st=h,t.done1=!0):2===e&&r>=.5*a&&r<=1.5*a&&(t.line.et=h,t.done2=!0)};n(t,e),n(i,a)}else{const r=(new s.Vector2).subVectors(t.line.et,t.line.st).normalize(),u=(new s.Vector2).subVectors(i.line.et,i.line.st).normalize();if(Math.abs(r.dot(u))>Math.cos(Math.PI/18)){const u=(new s.Vector2).subVectors(c,l);if(Math.abs(r.dot(u))<.2){const u=new s.Vector2(-r.y,r.x),d=(new s.Vector2).addVectors(c,l).multiplyScalar(.5),p={line:{st:o.getLinePt(d,u,-5),et:o.getLinePt(d,u,5)},done1:!0,done2:!0,pts:[]};h=o.lineIntersect(t.line.st,t.line.et,p.line.st,p.line.et),h&&(1===e?(t.line.st=h,t.done1=!0):2===e&&(t.line.et=h,t.done2=!0),p.line.st=h),h=o.lineIntersect(i.line.st,i.line.et,p.line.st,p.line.et),h&&(1===a?(i.line.st=h,i.done1=!0):2===a&&(i.line.et=h,i.done2=!0),p.line.et=h),n.push(p)}}}};for(const t of i){if(t.done1&&t.done2)continue;const e=i.filter((e=>e!==t));if(!t.done1){let n,i=1e10,s=-1;for(const a of e){if(!a.done1){const e=o.pointDistance(t.line.st,a.line.st);e<i&&(i=e,n=a,s=1)}if(!a.done2){const e=o.pointDistance(t.line.st,a.line.et);e<i&&(i=e,n=a,s=2)}}s>0&&n&&a(t,1,n,s,i)}if(!t.done2){let n,i=1e10,s=-1;for(const a of e){if(!a.done1){const e=o.pointDistance(t.line.et,a.line.st);e<i&&(i=e,n=a,s=1)}if(!a.done2){const e=o.pointDistance(t.line.et,a.line.et);e<i&&(i=e,n=a,s=2)}}s>0&&n&&a(t,2,n,s,i)}}return n}(u),{resultLines:u.map((t=>t.line)),leftPoints:c}}},882:function(t,e,n){var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.addLinesToScene=e.addPointsToScene=e.lineIntersect=e.lineIntersectHull=e.vecAngle=e.linearRegression=e.ransac=e.getLineDistance=e.getLinePt=e.getLineParam=e.pointDistance=e.pointInPolygon2D=e.minDistanceToPts=e.PtInLoopType=e.addPtToBox=e.centroidOfPts=void 0;const a=n(212),r=o(n(32));function h(t,e,n=.001){return t===e||Math.abs(t-e)<=n}function l(t,e,n=.001){return t-e<-n}function c(t,e,n=.001){return t-e>n}function u(t,e,n=.001){return t-e>=-n}function d(t,e){return Array.isArray(t)?Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])):Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function p(t,e,n){const i=n.x-t.x,s=n.y-t.y;return i*e.x+s*e.y}function f(t,e,n){return{x:t.x+e.x*n,y:t.y+e.y*n}}function m(t,e,n){const i=n.x-t.x,s=n.y-t.y;return Math.abs(i*e.y-s*e.x)}e.centroidOfPts=function(t,e){let n=0,i=0;for(let s=0;s<t.length;s++)n+=t[s][0]-e[0],i+=t[s][1]-e[1];return[n/t.length+e[0],i/t.length+e[1]]},e.addPtToBox=function(t,e){const n=Math.min(e[0],t.min[0]),i=Math.min(e[1],t.min[1]),s=Math.max(e[0],t.max[0]),o=Math.max(e[1],t.max[1]);t.min=[n,i],t.max=[s,o]},function(t){t[t.Inside=1]="Inside",t[t.Outside=0]="Outside",t[t.OnEdge=-1]="OnEdge",t[t.OnVertex=-2]="OnVertex"}(e.PtInLoopType||(e.PtInLoopType={})),e.minDistanceToPts=function(t,e){let n=Number.MAX_VALUE;return t.forEach((t=>{const i=t[0]-e[0],s=t[1]-e[1],o=i*i+s*s;o<n&&(n=o)})),Math.sqrt(n)},e.pointInPolygon2D=function(t,e,n=.001){let i=0;const s=e.length;if(s<3)return 0;let o=e[0];for(let a=1;a<=s;++a){const r=a===s?e[0]:e[a];if(h(r.y,t.y,n)&&(h(r.x,t.x,n)||h(o.y,t.y,n)&&c(r.x,t.x,n)===l(o.x,t.x,n)))return-1;if(l(o.y,t.y,n)!==l(r.y,t.y,n))if(u(o.x,t.x,n))if(c(r.x,t.x,n))i=1-i;else{const e=o.x-t.x,s=o.y-t.y,a=r.x-t.x,h=r.y-t.y,l=r.x-o.x,u=r.y-o.y,d=e*h-a*s;if(d*d<=n*n*(l*l+u*u))return-1;d>0===c(r.y,o.y,n)&&(i=1-i)}else if(c(r.x,t.x,n)){const e=o.x-t.x,s=o.y-t.y,a=r.x-t.x,h=r.y-t.y,l=r.x-o.x,u=r.y-o.y,d=e*h-a*s;if(d*d<=n*n*(l*l+u*u))return-1;d>0===c(r.y,o.y,n)&&(i=1-i)}o=r}return i},e.pointDistance=d,e.getLineParam=p,e.getLinePt=f,e.getLineDistance=m,e.ransac=function(t,e){if(t.length<2)return;if(2===t.length){if(d(t[0],t[1])<.001)return;return{line:{st:t[0],et:t[1]},innerPts:[t[0],t[1]]}}const n=Math.ceil(t.length/2),i=[];for(let s=0;s<n;s++){const n=Math.floor(Math.random()*t.length),s=Math.floor(Math.random()*t.length);if(n===s||d(t[n],t[s])<.001)continue;const o={st:t[n],et:t[s]},r=(new a.Vector2).subVectors(o.et,o.st).normalize(),h=t.filter((i=>m(t[n],r,i)<e));i.push({line:o,lineDir:r,innerPts:h})}if(!i.length)return;i.sort(((t,e)=>t.innerPts.length-e.innerPts.length));const s=i.pop();if(s.innerPts.length<2)return;const o=s.innerPts.map((t=>p(s.line.st,s.lineDir,t)));return o.sort(((t,e)=>t-e)),{line:{st:f(s.line.st,s.lineDir,o[0]),et:f(s.line.st,s.lineDir,o[o.length-1])},innerPts:s.innerPts}},e.linearRegression=function(t){if(t.length<2)return;if(2===t.length&&d(t[0],t[1])<.001)return;let e=0,n=0;for(let i=0;i<t.length;i++)e+=t[i].x,n+=t[i].y;let i=e/t.length,s=n/t.length,o=0,a=0,h=0;for(let e=0;e<t.length;e++){const n=t[e].x-i,r=t[e].y-s;o+=n*n,a+=n*r,h+=r*r}const l=r.eig([[o,a],[a,h]]);if(l.E.x.length>0){let e={x:i,y:s},n={x:l.E.x[0][0],y:l.E.x[0][1]};const o=t.slice().sort(((t,i)=>p(e,n,t)-p(e,n,i)));return{st:f(e,n,p(e,n,o[0])),et:f(e,n,p(e,n,o[o.length-1]))}}},e.vecAngle=function(t,e){const n=Math.sqrt(t[0]*t[0]+t[1]*t[1]),i=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return Math.acos((t[0]*e[0]+t[1]*e[1])/n/i)},e.lineIntersectHull=function(t,e,n,i){const s=[];for(let o=0;o<t.length-1;o++){if(t[o].y<=e&&t[o+1].y<=e)continue;if(t[o].y>=n&&t[o+1].y>=n)continue;const a=t[o+1].y-t[o].y;Math.abs(a)<=1e-4&&(s.push(Math.floor(t[o].x/i)),s.push(Math.floor(t[o+1].x/i)));const r=(t[o+1].x-t[o].x)*(e-t[o].y)/a+t[o].x,h=(t[o+1].x-t[o].x)*(n-t[o].y)/a+t[o].x;s.push(Math.floor(r/i)),s.push(Math.floor(h/i))}return s.sort(((t,e)=>t-e)),s.length?{start:s[0],end:s[s.length-1]}:{start:0,end:0}},e.lineIntersect=function(t,e,n,i){const s=(new a.Vector2).subVectors(e,t).normalize(),o=(new a.Vector2).subVectors(i,n).normalize();if(Math.abs(s.dot(o))>Math.cos(Math.PI/36))return;const h=[[s.x,-o.x],[s.y,-o.y]],l=[n.x-t.x,n.y-t.y];return f(t,s,r.solve(h,l)[0])},e.addPointsToScene=function(t,e,n=2201331,i=1){const s=(new a.BufferGeometry).setFromPoints(t),o=new a.PointsMaterial({color:n,size:i}),r=new a.Points(s,o);e.add(r)},e.addLinesToScene=function(t,e,n=16711680){const i=t.map((t=>new a.Vector2(t.x,t.y)));var s=(new a.BufferGeometry).setFromPoints(i),o=new a.LineBasicMaterial({color:n}),r=new a.Line(s,o);e.add(r)}}},n={};function i(t){var s=n[t];if(void 0!==s)return s.exports;var o=n[t]={exports:{}};return e[t].call(o.exports,o,o.exports,i),o.exports}i.m=e,t=[],i.O=function(e,n,s,o){if(!n){var a=1/0;for(l=0;l<t.length;l++){n=t[l][0],s=t[l][1],o=t[l][2];for(var r=!0,h=0;h<n.length;h++)(!1&o||a>=o)&&Object.keys(i.O).every((function(t){return i.O[t](n[h])}))?n.splice(h--,1):(r=!1,o<a&&(a=o));r&&(t.splice(l--,1),e=s())}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[n,s,o]},i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){var t={179:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var s,o,a=n[0],r=n[1],h=n[2],l=0;for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(h)var c=h(i);for(e&&e(n);l<a.length;l++)o=a[l],i.o(t,o)&&t[o]&&t[o][0](),t[a[l]]=0;return i.O(c)},n=self.webpackChunkthree_typescript_webpack_starter=self.webpackChunkthree_typescript_webpack_starter||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}(),i.O(void 0,[930],(function(){return i(178)}));var s=i.O(void 0,[930],(function(){return i(941)}));s=i.O(s)}();